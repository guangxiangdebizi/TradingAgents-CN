# TradingAgents åç«¯å¾®æœåŠ¡æµ‹è¯•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«TradingAgentsåç«¯å¾®æœåŠ¡ç³»ç»Ÿçš„å®Œæ•´æµ‹è¯•å·¥å…·å’Œæ–‡æ¡£ï¼Œç”¨äºéªŒè¯ç³»ç»Ÿçš„åŠŸèƒ½æ€§ã€ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ docs/test/
â”‚   â”œâ”€â”€ README.md                           # æœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ microservices-test-plan.md          # è¯¦ç»†æµ‹è¯•è®¡åˆ’
â”‚   â””â”€â”€ test_report_YYYYMMDD_HHMMSS.json   # æµ‹è¯•æŠ¥å‘Šï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â””â”€â”€ test/
    â”œâ”€â”€ test_microservices.py              # Pythonå®Œæ•´æµ‹è¯•è„šæœ¬
    â”œâ”€â”€ test_microservices.ps1             # PowerShellå¿«é€Ÿæµ‹è¯•è„šæœ¬
    â””â”€â”€ run_tests.bat                       # Windowsæµ‹è¯•å¯åŠ¨å™¨
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨å™¨ï¼ˆæ¨èï¼‰

```bash
# Windows - è¿›å…¥backend/testç›®å½•
cd backend/test
run_tests.bat

# ç„¶åé€‰æ‹©æµ‹è¯•ç±»å‹:
# 1. Pythonå®Œæ•´æµ‹è¯• (æ¨è)
# 2. PowerShellå¿«é€Ÿæµ‹è¯•  
# 3. ä»…å¥åº·æ£€æŸ¥
# 4. ä»…æ•°æ®æœåŠ¡æµ‹è¯•
# 5. ä»…LLMæœåŠ¡æµ‹è¯•
# 6. ä»…ç½‘å…³æµ‹è¯•
```

### æ–¹æ³•2: ç›´æ¥è¿è¡ŒPythonè„šæœ¬

```bash
# è¿›å…¥backend/testç›®å½•
cd backend/test

# å®Œæ•´æµ‹è¯•
python test_microservices.py
```

### æ–¹æ³•3: ç›´æ¥è¿è¡ŒPowerShellè„šæœ¬

```powershell
# è¿›å…¥backend/testç›®å½•
cd backend/test

# å®Œæ•´æµ‹è¯•
powershell -ExecutionPolicy Bypass -File test_microservices.ps1

# ä»…å¥åº·æ£€æŸ¥
powershell -ExecutionPolicy Bypass -File test_microservices.ps1 -TestType health

# ä»…æ•°æ®æœåŠ¡æµ‹è¯•
powershell -ExecutionPolicy Bypass -File test_microservices.ps1 -TestType data
```

## ğŸ§ª æµ‹è¯•ç±»å‹

### 1. å¥åº·æ£€æŸ¥æµ‹è¯• (health)
- éªŒè¯æ‰€æœ‰å¾®æœåŠ¡çš„åŸºæœ¬å¯ç”¨æ€§
- æ£€æŸ¥æœåŠ¡å“åº”æ—¶é—´
- éªŒè¯æ•°æ®åº“å’ŒRedisè¿æ¥

### 2. æ•°æ®æœåŠ¡æµ‹è¯• (data)
- è‚¡ç¥¨ä¿¡æ¯æŸ¥è¯¢åŠŸèƒ½
- ç¼“å­˜æœºåˆ¶éªŒè¯
- å¼ºåˆ¶åˆ·æ–°åŠŸèƒ½
- æ•°æ®å‡†ç¡®æ€§éªŒè¯

### 3. LLMæœåŠ¡æµ‹è¯• (llm)
- æ¨¡å‹å¯ç”¨æ€§æ£€æŸ¥
- èŠå¤©å®Œæˆæ¥å£æµ‹è¯•
- ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½

### 4. ç½‘å…³æµ‹è¯• (gateway)
- APIè·¯ç”±åŠŸèƒ½
- å‚æ•°ä¼ é€’éªŒè¯
- é”™è¯¯å¤„ç†æµ‹è¯•

### 5. åˆ†æå¼•æ“æµ‹è¯• (analysis)
- åˆ†æä»»åŠ¡å¯åŠ¨
- è¿›åº¦æŸ¥è¯¢
- ç»“æœè·å–

### 6. é›†æˆæµ‹è¯• (integration)
- ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•
- å¤šæœåŠ¡åä½œéªŒè¯
- æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåï¼Œä¼šåœ¨ `backend/docs/test/` ç›®å½•ä¸‹ç”ŸæˆJSONæ ¼å¼çš„æµ‹è¯•æŠ¥å‘Šï¼š

```json
{
  "test_summary": {
    "total_tests": 25,
    "passed_tests": 23,
    "failed_tests": 2,
    "pass_rate": "92.0%",
    "test_time": "2025-07-22T23:45:30"
  },
  "test_results": [
    {
      "test_name": "Health-data_service",
      "passed": true,
      "message": "æœåŠ¡æ­£å¸¸ (156ms)",
      "details": {...},
      "timestamp": "2025-07-22T23:45:30"
    }
  ]
}
```

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### å‰ç½®æ¡ä»¶
1. **Python 3.10+** ç¯å¢ƒ
2. **æ‰€æœ‰å¾®æœåŠ¡æ­£å¸¸è¿è¡Œ**:
   - API Gateway (8000)
   - Analysis Engine (8001)
   - Data Service (8002)
   - LLM Service (8004)
   - Agent Service (8008)

3. **åŸºç¡€è®¾æ–½æœåŠ¡**:
   - MongoDB (27017)
   - Redis (6379)

### ç¯å¢ƒå˜é‡
ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²é…ç½®ï¼š
```bash
DEEPSEEK_API_KEY=your_deepseek_key
DASHSCOPE_API_KEY=your_dashscope_key
TUSHARE_TOKEN=your_tushare_token
MONGODB_URL=mongodb://localhost:27017
REDIS_URL=redis://localhost:6379
```

## ğŸ¯ æµ‹è¯•ç”¨ä¾‹è¯´æ˜

### TC001: ç³»ç»Ÿå¥åº·æ£€æŸ¥
- **ç›®æ ‡**: éªŒè¯æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ
- **éªŒè¯ç‚¹**: HTTP 200å“åº”ã€å“åº”æ—¶é—´ < 2ç§’
- **æµ‹è¯•æ•°æ®**: æ— 

### TC002: è‚¡ç¥¨ä¿¡æ¯æŸ¥è¯¢
- **ç›®æ ‡**: éªŒè¯è‚¡ç¥¨æ•°æ®è·å–åŠŸèƒ½
- **éªŒè¯ç‚¹**: æ•°æ®å®Œæ•´æ€§ã€å‡†ç¡®æ€§ã€å“åº”æ—¶é—´
- **æµ‹è¯•æ•°æ®**: 000001(å¹³å®‰é“¶è¡Œ), 600519(è´µå·èŒ…å°), 000002(ä¸‡ç§‘A)

### TC003: ç¼“å­˜æœºåˆ¶éªŒè¯
- **ç›®æ ‡**: éªŒè¯Redisç¼“å­˜åŠŸèƒ½
- **éªŒè¯ç‚¹**: ç¼“å­˜å‘½ä¸­ã€å“åº”æ—¶é—´ä¼˜åŒ–ã€æ•°æ®ä¸€è‡´æ€§
- **æµ‹è¯•æ•°æ®**: åŒTC002

### TC004: LLMæœåŠ¡åŠŸèƒ½
- **ç›®æ ‡**: éªŒè¯AIæ¨¡å‹æœåŠ¡
- **éªŒè¯ç‚¹**: æ¨¡å‹å¯ç”¨æ€§ã€èŠå¤©å“åº”ã€ä½¿ç”¨ç»Ÿè®¡
- **æµ‹è¯•æ•°æ®**: æ ‡å‡†æµ‹è¯•æç¤ºè¯

### TC005: APIç½‘å…³è·¯ç”±
- **ç›®æ ‡**: éªŒè¯è¯·æ±‚è·¯ç”±å’Œå‚æ•°ä¼ é€’
- **éªŒè¯ç‚¹**: è·¯ç”±æ­£ç¡®æ€§ã€å‚æ•°ä¼ é€’ã€é”™è¯¯å¤„ç†
- **æµ‹è¯•æ•°æ®**: è‚¡ç¥¨æŸ¥è¯¢è¯·æ±‚

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**
   ```
   âŒ data_service è¿æ¥å¤±è´¥: Connection refused
   ```
   **è§£å†³**: æ£€æŸ¥å¯¹åº”æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Œç«¯å£æ˜¯å¦æ­£ç¡®

2. **APIå¯†é’¥é”™è¯¯**
   ```
   âŒ LLMèŠå¤©æµ‹è¯•å¤±è´¥: Unauthorized
   ```
   **è§£å†³**: æ£€æŸ¥ç¯å¢ƒå˜é‡ä¸­çš„APIå¯†é’¥é…ç½®

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```
   âŒ MongoDB è¿æ¥å¤±è´¥
   ```
   **è§£å†³**: ç¡®ä¿MongoDBæœåŠ¡è¿è¡Œåœ¨localhost:27017

4. **ç¼“å­˜æµ‹è¯•å¤±è´¥**
   ```
   âŒ ç¼“å­˜æœºåˆ¶å¼‚å¸¸
   ```
   **è§£å†³**: æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€ï¼Œæ¸…é™¤ç¼“å­˜åé‡è¯•

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**:
   ```bash
   # å¯ç”¨è¯¦ç»†æ—¥å¿—
   set LOG_LEVEL=DEBUG
   python test_microservices.py
   ```

2. **å•ç‹¬æµ‹è¯•æœåŠ¡**:
   ```bash
   curl http://localhost:8002/health
   ```

3. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**:
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -an | findstr :8002
   ```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### å“åº”æ—¶é—´åŸºå‡†
- **å¥åº·æ£€æŸ¥**: < 100ms
- **è‚¡ç¥¨ä¿¡æ¯æŸ¥è¯¢**: < 2000ms
- **ç¼“å­˜å‘½ä¸­**: < 200ms
- **LLMèŠå¤©**: < 10000ms

### æˆåŠŸç‡åŸºå‡†
- **æ•°æ®å‡†ç¡®æ€§**: > 95%
- **ç¼“å­˜å‘½ä¸­ç‡**: > 80%
- **æœåŠ¡å¯ç”¨æ€§**: > 99%

## ğŸ”„ æŒç»­é›†æˆ

### è‡ªåŠ¨åŒ–æµ‹è¯•å»ºè®®
1. **æ¯æ¬¡ä»£ç æäº¤**: è¿è¡Œå¥åº·æ£€æŸ¥æµ‹è¯•
2. **æ¯æ—¥æ„å»º**: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
3. **å‘å¸ƒå‰**: è¿è¡Œæ€§èƒ½å’Œé›†æˆæµ‹è¯•

### ç›‘æ§é›†æˆ
- å°†æµ‹è¯•ç»“æœé›†æˆåˆ°ç›‘æ§ç³»ç»Ÿ
- è®¾ç½®æµ‹è¯•å¤±è´¥å‘Šè­¦
- è·Ÿè¸ªæ€§èƒ½è¶‹åŠ¿

## ğŸ“ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹
1. åœ¨ `test_microservices.py` ä¸­æ·»åŠ æµ‹è¯•å‡½æ•°
2. æ›´æ–° `microservices-test-plan.md` æ–‡æ¡£
3. åœ¨PowerShellè„šæœ¬ä¸­æ·»åŠ å¯¹åº”åŠŸèƒ½

### æµ‹è¯•ç”¨ä¾‹å‘½åè§„èŒƒ
- æ ¼å¼: `test_<åŠŸèƒ½>_<åœºæ™¯>`
- ç¤ºä¾‹: `test_stock_info_valid_symbol`

### ç»“æœè®°å½•è§„èŒƒ
```python
self.record_result(
    test_name="TestName-Identifier",
    passed=True/False,
    message="ç®€çŸ­æè¿°",
    details={"key": "value"}
)
```

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Šä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥æœåŠ¡æ—¥å¿—æ–‡ä»¶
3. å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†
4. æäº¤Issueåˆ°é¡¹ç›®ä»“åº“
